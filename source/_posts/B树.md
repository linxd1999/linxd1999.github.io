---
title: B树
tags: [DataStructure , Tree]
---



### 一.B树

#### 1.概念

- B树：平衡的多路搜索树，多用于文件系统、数据库的实现(也叫B-树)
- 特点：
  - 一个节点可以存储超过两个元素，可以拥有超过两个子节点
  - 拥有二叉平衡搜索树的一些性质
  - 所有节点高度一致
  - 比较矮
- B树和二叉搜索树，在逻辑上等价
- 多代节点合并，获得一个超级节点
  - 2代合并的超级节点，最多拥有4个子节点(至少是4阶B树)
  - 3代合并的超级节点，最多拥有8个子节点(至少是8阶B树)

#### 2.m阶B树的性质

- 假设一个节点存储的元素个数为x
  - 根节点：1 ≤ x ≤ m-1
  - 非根节点：ceiling(m/2)-1 ≤ x ≤ m-1
- 如果有子节点，子节点个数y=x+1
  - 根节点：2 ≤ x ≤ m
  - 非根节点：ceiling(m/2) ≤ x ≤ m
- 例如m=3，2 ≤ y ≤ 3，称为(2,3)树、2-3树
- 例如m=4，2 ≤ y ≤ 4，称为(2,4)树、2-3-4树
- 若m = 2，B树就是平衡二叉搜索树
- m阶B树，最多需要log2m代合并
- 示例：

![Btree1](D:\blog\source\_posts\B树\Btree1.png)

![Btree2](D:\blog\source\_posts\B树\Btree2.png)

![Btree3](D:\blog\source\_posts\B树\Btree3.png)

### 二.B树的操作

#### 1.搜索

1. 先在节点内部从小到大开始搜索元素
2. 命中，搜索结束
3. 未命中，再去对应的子节点中去搜索元素，重复步骤1

#### 2.添加

- 新添加的元素必定是添加到叶子节点
- 若叶子节点的元素数量超过m阶B树的元素数量上限(m-1)，发生上溢(overflow)

#### 3.上溢

- 上溢的节点元素个数必然是m
- 将上溢节点最中间的元素k向上与父节点合并，[0，k-1]和[k+1，m-1]位置的元素分裂成两个子节点(这两个子节点的元素个数都高于ceiling(m/2)-1)
- 一次分裂完成后，可能导致父节点上溢。最极端的情况是一直分裂到父节点

![overflow](D:\blog\source\_posts\B树\overflow.png)

#### 4.删除

- 删除叶子节点：在满足节点元素的个数的前提下直接删除即可
- 删除非叶子节点
  - 找到前驱或后继元素，覆盖所需删除元素的值
  - 删除前驱或后继元素
  - 非叶子节点的前驱或后继，必定在叶子节点中(实际还是删除叶子节点)
- 删除节点后，可能发生下溢

#### 5.下溢

- 下溢：节点元素数量等于ceiling(m/2)-2
- 如果下溢节点临近的兄弟节点，有至少ceiling(m/2)个元素，可以向其借一个元素
  - 将父节点的元素b插入到下溢节点的0位置(最小位置)
  - 用兄弟节点的元素a(最大的元素)替代父节点的元素b
  - 实质就是旋转

![underflow1](D:\blog\source\_posts\B树\underflow1.png)

- 如果下溢节点临近的兄弟节点，只有ceiling(m/2)-1个元素
  - 将父节点的元素b拿下来与左右子节点进行合并
  - 合并后的节点元素个数等于ceiling(m/2)+ceiling(m/2)-2，不超过m-1
  - 这个操作可能会导致父节点下溢，依然按照上述方法解决，下溢现象可能会一直往上传播

![underflow2](D:\blog\source\_posts\B树\underflow2.png)